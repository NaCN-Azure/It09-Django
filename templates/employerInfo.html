{% extends 'base.html' %}
{% load static %}

{% block title_block %}
Company Information
{% endblock %}


{% block body_block %}

<style>
    .bd-sidebar {
        height: 60vh;
        overflow-y: auto;
        padding: 20px;
    }
    /* Modal Content Style */
.modal-content {
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* Modal Header Style */
.modal-header {
    border-bottom: 1px solid #eee;
    padding: 20px;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
}

.modal-title {
    font-size: 24px;
    font-weight: 600;
}

/* Modal Body Style */
.modal-body {
    padding: 20px;
}

label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    font-size: 16px;
}

input[type="text"],
input[type="number"],
input[type="date"],
select,
textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box; /* Ensures padding doesn't affect overall width */
}

select {
    background-color: #fff;
    cursor: pointer;
}

/* Modal Footer Style */
.modal-footer {
    padding: 20px;
    border-top: 1px solid #eee;
}

/* Buttons Style */
.btn-primary {
    background-color: #007bff;
    border-color: #007bff;
    color: #fff;
}

.btn-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
}

.btn-primary:hover {
    background-color: #0056b3;
    border-color: #0056b3;
}

.btn-secondary:hover {
    background-color: #545b62;
    border-color: #545b62;
}

.btn {
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 4px;
    cursor: pointer;
    border: 1px solid transparent; /* Remove default border */
    transition: background-color 0.2s ease-in-out;
}

.btn:not(:last-child) {
    margin-right: 10px;
}

.btn-close {
    border: none;
    background: transparent;
    font-size: 20px;
}

.btn:focus {
    outline: none;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}
.user-image{
                flex:50%;
                display:flex;
                height:230px;
                justify-content:center;
                align-items:center;
                max-width:30%;
                overflow:hidden;
}
.user-image img{
                max-width:100%;
                max-height:100%;
                height:auto;
                object-fit:contain;
}
</style>


<!-- My profile部分 -->
<div class="row pb-4 mb-4 border-bottom">
    <div class="col">
        <h3 class=" fst-italic ">
            My Profile
        </h3>
    </div>
    <div class="col-auto">
        <button type="button" class="btn btn-primary btn-sm px-4 me-md-2" data-bs-toggle="modal"
            data-bs-target="#changeModal">Change Password
        </button>
        <button type="button" class="btn btn-primary btn-sm px-4 me-md-2" data-bs-toggle="modal"
            data-bs-target="#profileModal">Edit
        </button>

        <!-- The Modal -->
        <div class="modal" id="profileModal">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title">Personal Profile</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <!-- Modal Body -->
                    <div class="modal-body">
                        <!-- The form goes here -->
                        <form>
                            <div class="form-group mb-3">
                                <label for="username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="username" value = {{user.user_name}}>
                            </div>
                            <div class="form-group mb-3">
                                <label for="Email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="Email" value = {{user.email}}>
                            </div>
                            <div class="form-group mb-3">
                                <label for="phone" class="form-label">Phone</label>
                                <input type="text" class="form-control" id="phone" value = {{user.phone}}>
                            </div>
                            <div class="form-group mb-3">
                                <label for="City" class="form-label">City</label>
                                <input type="text" class="form-control" id="City" value = {{user.city}}>
                            </div>

                            <!-- Modal Footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="changeModal">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title">Change Password</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <!-- Modal Body -->
                    <div class="modal-body">
                        <form id="changePasswordForm">
                            <div class="form-group mb-3">
                                <label for="newPassword" class="form-label">New Password</label>
                                <input type="password" class="form-control" id="newPassword" required>
                            </div>
                            <div class="form-group mb-3">
                                <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
                                <input type="password" class="form-control" id="confirmNewPassword" required>
                            </div>

                            <!-- Modal Footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" onclick="handleSubmitChangePassword()">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="bd-content ps-lg-2 pb-4 mb-2" style="display: flex; align-items: flex-start;">
    <div style="flex-grow: 1;">
    <ul>
        <li><strong>Company Name:</strong> {{ user.user_name }}</li>
        <li><strong>Phone:</strong> {{ user.phone }}</li>
        <li><strong>Email:</strong> {{ user.email }}</li>
        <li><strong>City:</strong> {{ user.city }}</li>
<!--        <li><strong>Company Introduction:</strong> Lidl is a leading global supermarket chain known for-->
<!--            its commitment to providing high-quality products at affordable prices. With a strong-->
<!--            presence in the retail industry, we strive to make shopping convenient, enjoyable, and-->
<!--            budget-friendly for our customers.-->
<!--        </li>-->
    </ul>
    </div>
    <div class="user-image" onclick="document.getElementById('id_user_image_{{ user.id }}').click();">
        {% if user.avatar %}
        <img src="{{ user.avatar }}" alt="{{ user.title }}">
        {% else %}
            {% if user.type == 1 %}
        <img src="{% static 'image/default-user.jpg' %}" alt="Default User Image">
            {% elif user.type == 2 %}
        <img src="{% static 'image/default-employer.jpg' %}" alt="Default User Image">
            {% endif %}
        {% endif %}
        <form id="upload_form_{{ user.id }}" method="post" enctype="multipart/form-data" style="display:none;">
                                {% csrf_token %}
                                <input type="file" name="user_image" id="id_user_image_{{ user.id }}" onchange="uploadFormSubmit({{ user.id }});">
        </form>
    </div>
</div>


<!-- My Posts部分 -->
<div class="row pb-4 mb-4 border-bottom">
    <div class="col">
        <h3 class=" fst-italic ">
            My Posts
        </h3>
    </div>
    <div class="col-auto">
        <button type="button" class="btn btn-primary btn-sm px-4 me-md-2" data-bs-toggle="modal"
            data-bs-target="#postModal">New
        </button>

        <!-- The Modal -->
        <div class="modal" id="postModal">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">New Post</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <!-- Modal Body -->
            <div class="modal-body">
                <label for="title">Job Title:</label>
                <input type="text" id="title" name="title" value="">

                <label for="type">Type:</label>
                <select id="type" name="type">
                    {% for value, label in select.job_type_choices %}
                    <option value="{{ value }}" {% if value == job.type %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>

                <label for="requirement">Requirement:</label>
                <select id="requirement" name="requirement">
                    {% for value, label in select.job_request_choices %}
                    <option value="{{ value }}" {% if value == job.requirement %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>

                <label for="remote">Remote:</label>
                <select id="remote" name="remote">
                    {% for value, label in select.job_remote_choices %}
                    <option value="{{ value }}" {% if value == job.remote %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>

                <label for="industry">Industry:</label>
                <select id="industry" name="industry">
                    {% for value, label in select.job_industry_choices %}
                    <option value="{{ value }}" {% if value == job.industry %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>

                <label for="salary">Salary:</label>
                <input type="number" id="salary" name="salary" value="">

                <label for="start_date">Start Date:</label>
                <input type="date" id="start_date" name="start_date" placeholder="YYYY-MM-DD">

                <label for="end_date">End Date:</label>
                <input type="date" id="end_date" name="end_date" placeholder="YYYY-MM-DD">

                <label for="city">City:</label>
                <input type="text" id="city" name="city" value="">

                <label for="postcode">Postcode:</label>
                <input type="text" id="postcode" name="postcode" value="">

                <label for="other">Other:</label>
                <textarea id="other" name="other"></textarea>

                <label for="description">Job Description:</label>
                <textarea id="description" name="description"></textarea>
            </div>
            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" onclick="handleJobCreate()">Save changes</button>
            </div>
        </div>
    </div>
</div>

    </div>
</div>

<div class="bd-sidebar ps-lg-2  pb-4 mb-4 ">
    <div class=list-group id="jobs-list">
        <!-- job list -->
    
    </div>
</div>


<!-- My reviews部分 -->
    <h3 class="pb-4 mb-4 fst-italic border-bottom">
        My Received Feedback
    </h3>

<div class="bd-sidebar ps-lg-2  pb-4 mb-4 ">
    <div class=list-group id="userFeedbacks">
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        var today = new Date().toISOString().slice(0, 10);
        document.getElementById('start_date').value = today;
        document.getElementById('end_date').value = today;
    });
    var jobDetailBaseUrl = "{% url 'job_detail' job_id=0 %}".replace('/0/', '/');
    var deleteJobUrlTemplate = "{% url 'delete_job' job_id=0 %}".replace('/0/', '/%jobId%/');
    function getStatusBadge(status) {
        switch (status) {
            case 1:
                return '<span class="badge bg-primary-subtle text-primary-emphasis rounded-pill">Applying</span>';
            case 2:
                return '<span class="badge bg-success-subtle text-success-emphasis rounded-pill">Success</span>';
            case 3:
                return '<span class="badge bg-danger-subtle text-danger-emphasis rounded-pill">Rejected</span>';
            case 4:
                return '<span class="badge bg-dark-subtle text-dark-emphasis rounded-pill">Error</span>';
            default:
                return '<span class="badge bg-secondary-subtle text-secondary-emphasis rounded-pill">Unknown</span>';
        }
    };

    $(document).ready(function() { 
    $.ajax({
        url: '{% url "get_job_by_employer_Id" user.id %}',
        type: 'GET',
        dataType: 'json',
        success: function (response) {
            var jobsHtml = ''

            var jobIds = response.jobs.map(job => job.id);
           response.jobs.forEach( function(job) {
                var start_date = job.start_date.split('T')[0];
                var end_date = job.end_date.split('T')[0];
                var jobDetailUrl = jobDetailBaseUrl + job.id + '/';
               jobsHtml += `
                    <div class="list-group-item" role="button" aria-expanded="false">
                       <div class="d-flex w-100 justify-content-between my-2">
                       <a href="#item${job.id}Content" data-bs-toggle="collapse" aria-controls="item${job.id}Content">
                           <h5 class="mb-1 text-primary">${job.title}</h5>
                       </a>
                           <p class="mb-1">Salary: £${ job.salary} / hour</p>
                           <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-warning btn-sm px-4" onclick = "event.stopPropagation();" data-bs-toggle="modal" data-bs-target="#EditPost${ job.id }">Edit</button>
                            <button type="button" class="btn btn-primary btn-sm px-4 me-2" onclick=" event.stopPropagation();window.location.href='${jobDetailUrl}';">Detail</button>
                            <button type="button" class="btn btn-danger btn-sm px-4 me-2 delete-job" data-job-id="${job.id}" onclick="event.stopPropagation(); deleteJob(${job.id});">Delete</button>
                            </div>
                       </div>
                       <!-- The Modal -->
                       <div class="modal" id="EditPost${ job.id }">
                           <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                               <div class="modal-content">

                                   <!-- Modal Header -->
                                   <div class="modal-header">
                                       <h4 class="modal-title">Edit Post</h4>
                                       <button type="button" class="btn-close" data-bs-dismiss="modal"
                                           aria-label="Close"></button>
                                   </div>

                                   <!-- Modal Body -->
                                   <div class="modal-body">
                                        <label for="title${ job.id }">Job Title:</label>
                                        <input type="text" id="title${ job.id }" name="title" value="${ job.title }">

                                        <label for="type${ job.id }">Type:</label>
                                        <select id="type${ job.id }" name="type">
                                            {% for value, label in select.job_type_choices %}
                                            <option value="{{ value }}" {% if value == job.type %}selected{% endif %}>{{ label }}</option>
                                            {% endfor %}
                                        </select>

                                        <label for="requirement${ job.id }">Requirement:</label>
                                        <select id="requirement${ job.id }" name="requirement">
                                            {% for value, label in select.job_request_choices %}
                                            <option value="{{ value }}" {% if value == job.requirement %}selected{% endif %}>{{ label }}</option>
                                            {% endfor %}
                                        </select>

                                        <label for="remote${ job.id }">Remote:</label>
                                        <select id="remote${ job.id }" name="remote">
                                            {% for value, label in select.job_remote_choices %}
                                            <option value="{{ value }}" {% if value == job.remote %}selected{% endif %}>{{ label }}</option>
                                            {% endfor %}
                                        </select>

                                        <label for="industry${ job.id }">Industry:</label>
                                        <select id="industry${ job.id }" name="industry">
                                            {% for value, label in select.job_industry_choices %}
                                            <option value="{{ value }}" {% if value == job.industry %}selected{% endif %}>{{ label }}</option>
                                            {% endfor %}
                                        </select>

                                        <label for="salary${ job.id }">Salary:</label>
                                        <input type="number" id="salary${ job.id }" name="salary" value="${ job.salary }">

                                        <label for="start_date${ job.id }">Start Date:</label>
                                        <input type="date" id="start_date${ job.id }" name="start_date" value="${start_date}">

                                        <label for="end_date${ job.id }">End Date:</label>
                                        <input type="date" id="end_date${ job.id }" name="end_date" value="${end_date}">

                                        <label for="city${ job.id }">City:</label>
                                        <input type="text" id="city${ job.id }" name="city" value="${ job.city }">

                                        <label for="postcode${ job.id }">Postcode:</label>
                                        <input type="text" id="postcode${ job.id }" name="postcode" value="${ job.postcode}">

                                        <label for="other${ job.id }">Other:</label>
                                        <textarea id="other${ job.id }" name="other">${ job.other }</textarea>

                                        <label for="description${ job.id }">Job Description:</label>
                                        <textarea id="description${ job.id }" name="description">${ job.description }</textarea>
                                    </div>
                                        <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="submit" class="btn btn-primary" onclick="handleJobEdit(${ job.id })">Save changes</button>
                                        </div>
                               </div>
                           </div>
                       </div>

                   <!-- applications -->
                   <div class="collapse" id="item${ job.id }Content">
                       <div class="list-group" id="applications${job.id}">                        
                       </div>
                   </div>
                   </div>
                   `;
                // 获取并显示每个工作的申请
           });

           $('#jobs-list').html(jobsHtml); 
           response.jobs.forEach(function(job) {
            fetchAndDisplayApplications(job.id);
            
            });
            fetchAndDisplayFeedbacks(jobIds);

           
        },
        error: function (xhr, status, error) {
            console.error("Error fetching jobs info:", error);
        }
    });
   });
   
function fetchAndDisplayApplications(jobId) {
    $.ajax({
        url: '{% url "get_applications_by_job" 0 %}'.replace('0', jobId),
        type: 'GET',
        dataType: 'json',
        success: function(response) {
            var applicationsHtml = '';
            response.applications.forEach(function(application) {
            var statusBadge = getStatusBadge(application.status);
            var actionButtons = application.status === 1 ?
                    `<div class="d-flex gap-2 justify-content-between" role="group" aria-label="Small button group">
                        <button type="button" class="btn btn-success btn-sm rounded-pill px-3" onclick="updateApplicationStatus(${application.id}, 2)"><i class="bi bi-check-lg"></i> Hire</button>
                        <button type="button" class="btn btn-danger btn-sm rounded-pill px-3" onclick="updateApplicationStatus(${application.id}, 3)"><i class="bi bi-x-lg"></i> Reject</button>
                    </div>` : '';
                applicationsHtml += `
                    <a href="#" class="list-group-item list-group-item-action d-flex gap-3 py-3" aria-current="true">
                        <img src="{% static 'image/person-fill.svg' %}" alt="twbs" width="32" height="32" class="flex-shrink-0">
                        <div class="d-flex gap-2 w-100 justify-content-between">
                            <div>
                                <h6 class="mb-0">${application.user__user_name}</h6>
                                <p class="mb-0 opacity-75">${application.user__email}</p>
                                ${statusBadge}
                            </div>
                            ${actionButtons}
                        </div>
                    </a>
                `;
            });
            $(`#applications${jobId}`).html(applicationsHtml); // 确保每个工作的申请列表有一个唯一的 ID
        },
        error: function(xhr, status, error) {
            console.error("Error fetching applications:", error);
        }
    });
}


function fetchAndDisplayFeedbacks(jobIds) {
jobIds.forEach(function(jobId) {
    $.ajax({
        url: '{% url "get_feedback_by_job" 0 %}'.replace('0', jobId),
        type: 'GET',
        dataType: 'json',
        success: function (response) {
            var feedbacksHtml = '';
            response.feedbacks.forEach(function (feedback) {
                var jobDetailUrl = jobDetailBaseUrl + jobId + '/';
                feedbacksHtml += ` 
                        <a href="${jobDetailUrl}" class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between my-2">
                                <h5 class="mb-1 text-primary">${feedback.job__title}</h5>
                                <small>Rated: ${feedback.rate}/5</small>
                            </div>
                            <p class="mb-1">User: ${feedback.user__user_name}</p>
                            <p class="mb-1">Comment: ${feedback.comment}</p>
                            <p class="mb-1">Date: ${new Date(feedback.date).toLocaleDateString()}</p>
                        </a>
                    `;
            });
            $('#userFeedbacks').append(feedbacksHtml);
        },
        error: function (xhr, status, error) {
            console.error("Error fetching feedbacks:", error);
        }
    });
  });
 }
</script>
<script>
    function handleSubmitChangePassword() {
        var newPassword = $('#newPassword').val();
        var confirmNewPassword = $('#confirmNewPassword').val();
        if(newPassword !== confirmNewPassword) {
            alert('Passwords do not match.');
            return;
        }
        var userId = {{ user.id }};
        $.ajax({
            url: '{% url "change_password" user.id %}',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({new_password: newPassword}),
            beforeSend: function(xhr) {
                xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
            },
            success: function(response) {
                $('#changeModal').modal('hide');
                alert('Password changed successfully');
            },
            error: function(xhr, status, error) {
                alert('Error: ' + xhr.responseJSON.error);
            }
        });
    }


     $(document).ready(function() {
        $('form').on('submit', function(e) {
            e.preventDefault();
            var userId = {{ user.id }};
            var updateUrl = "{% url 'update_user_info' user_id=user.id %}";

            var formData = {
                "username": $('#username').val(),
                "email": $('#Email').val(),
                "phone": $('#phone').val(),
                "city": $('#City').val()
            };

            $.ajax({
                url: updateUrl,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}"); // 添加CSRF令牌
                },
                success: function(response) {
                    alert("User information updated successfully");
                    $('#profileModal').modal('hide');
                    location.reload();
                },
                error: function(xhr, status, error) {
                    alert("Failed to update user information");
                }
            });
        });
    });


    function handleJobCreate() {
            event.preventDefault();
            var jobData = {
                employer_id:{{user.id}},
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                type: document.getElementById('type').value,
                requirement: document.getElementById('requirement').value,
                remote: document.getElementById('remote').value,
                industry: document.getElementById('industry').value,
                start_date: document.getElementById('start_date').value,
                end_date: document.getElementById('end_date').value,
                salary: document.getElementById('salary').value,
                city: document.getElementById('city').value,
                postcode: document.getElementById('postcode').value,
                other: document.getElementById('other').value,
            };
            var jsonData = JSON.stringify(jobData);
            console.log(jsonData);
            var updateUrl = "{% url 'create_job' %}";
            $.ajax({
                url: updateUrl,
                type: 'POST',
                data: jsonData,
                processData: false,
                contentType: false,
                beforeSend: function(xhr, settings) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}"); // 添加CSRF令牌头
                },
                success: function(response) {
                    $('#editJobModal').modal('hide');
                    alert(response.message);
                    location.reload();
                },
                error: function(xhr, status, error) {
                    alert(xhr.responseJSON.error);
                }
            });
        };


    function handleJobEdit(jobId) {
            event.preventDefault();
            var jobData = {
                title: document.getElementById(`title${ jobId }`).value,
                type: document.getElementById(`type${jobId}`).value,
                requirement: document.getElementById(`requirement${jobId}`).value,
                remote: document.getElementById(`remote${jobId}`).value,
                industry: document.getElementById(`industry${jobId}`).value,
                salary: document.getElementById(`salary${jobId}`).value,
                start_date: document.getElementById(`start_date${jobId}`).value,
                end_date: document.getElementById(`end_date${jobId}`).value,
                city: document.getElementById(`city${jobId}`).value,
                postcode: document.getElementById(`postcode${jobId}`).value,
                other: document.getElementById(`other${jobId}`).value,
                description: document.getElementById(`description${jobId}`).value,
            };
            var jsonData = JSON.stringify(jobData);
            var updateUrl = "{% url 'update_job' 0 %}".replace('0', `${jobId}`);
            $.ajax({
                url: updateUrl,
                type: 'POST',
                data: jsonData,
                processData: false,
                contentType: false,
                beforeSend: function(xhr, settings) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}"); // 添加CSRF令牌头
                },
                success: function(response) {
                    $('#editJobModal').modal('hide');
                    alert(response.message);
                    location.reload();
                },
                error: function(xhr, status, error) {
                    alert(xhr.responseJSON.error);
                }
            });
        };


    function updateApplicationStatus(applicationId, newStatus) {
            var jsonData = JSON.stringify({status: newStatus});
            $.ajax({
                url: `{% url 'update_application_status' 0 %}`.replace('0', applicationId),
                type: 'POST',
                contentType: 'application/json',
                data: jsonData,
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                },
                success: function(response) {
                    alert(response.message);
                    location.reload();
                },
                error: function(xhr, status, error) {
                    alert(xhr.responseJSON.error);
                }
            });
        }


    function deleteJob(jobId) {
    var deleteUrl = deleteJobUrlTemplate.replace('%jobId%', jobId);
    if (confirm('Are you sure you want to delete this job? This action cannot be undone.')) {
        $.ajax({
            url: deleteUrl,
            type: 'DELETE',
            dataType: 'json',
            beforeSend: function(xhr, settings) {
                xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
            },
            success: function(response) {
                alert('Job deleted successfully.');
                location.reload();
            },
            error: function(xhr, status, error) {
                console.error('Failed to delete job:', error);
                alert('Failed to delete job. Please try again.');
            }
        });
    }
};


            function uploadFormSubmit(userId) {
                var formData = new FormData();
                formData.append('user_image', $('#id_user_image_' + userId)[0].files[0]);
                var uploadUrl = `{% url 'upload_user_image' user_id=0 %}`.replace('0', userId);
                $.ajax({
                    url: uploadUrl,
                    type: 'POST',
                    data: formData,
                    contentType: false,
                    processData: false,
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
                    },
                    success: function(data) {
                        alert('Picture Updated.');
                        location.reload();
                    },
                    error: function(error) {
                        alert('Failed to submit.'); // 提示用户反馈添加失败
                    }
                });
            }


</script>
{% endblock %}